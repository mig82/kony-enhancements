/*! KonyVisualizerV8420 2019-06-14 */

var __getDSObjIdForAnnotation__=function(t){return t.proj_guid+"_annotations_"+t.channel},__readAnnotationFromDataStore__=function(t){var n=__getDSObjIdForAnnotation__(t);if(kony.store.getItem(n)&&Object.keys(kony.store.getItem(n)).length>0){var o=kony.store.getItem(n);if(o[t.annotation_id])return o[t.annotation_id]}return null},__writeAnnotationToDataStore__=function(t,n){var o=__getDSObjIdForAnnotation__(t);if(kony.store.getItem(o)&&Object.keys(kony.store.getItem(o)).length>0){var e=kony.store.getItem(o);null!=n&&(e[t.annotation_id]=n),kony.store.setItem(o,e)}else{e={};null!=n&&(e[t.annotation_id]=n),kony.store.setItem(o,e)}},__addOrAppendAnnotationTODS__=function(t,n,o){var e=n,a=kony.ds.read("kvsession")[0].userDetails,_=t.annotation_id;function r(n){var o=annotationsUtil.createComment(e,a),_=o.commentId;return n.comments[e.widgetId]||(n.comments[e.widgetId]={}),n.comments[e.widgetId][_]=o,__writeAnnotationToDataStore__(t,n),n}e.widgetId=_,e.formId=_;try{var i=null;if(null!==__readAnnotationFromDataStore__(t)){var d=__readAnnotationFromDataStore__(t);e.channel=t.channel,i=r(d)}else e.channel=t.channel,i=r({widgetId:_,active:1,comments:{}});o({status:400,error:null,data:i})}catch(t){o({status:200,err:t,data:null})}},__deleteCommentFROMDS__=function(t,n,o){n.active=0,__updateCommentTODS__(t,n,o)},__updateCommentTODS__=function(t,n,o){var e=kony.ds.read("kvsession")[0].userDetails;try{if(null!==__readAnnotationFromDataStore__(t)){var a=__readAnnotationFromDataStore__(t);a=annotationsUtil.updateComment(n,e,a),__writeAnnotationToDataStore__(t,a),o({status:400,error:null,data:a})}}catch(t){o({status:200,err:t,data:null})}},__openAnnotation__=function(t,n){null!==__readAnnotationFromDataStore__(t)?n({status:400,data:__readAnnotationFromDataStore__(t)}):n({status:200,data:null})},fpas={addOrAppendAnnotationTODS:__addOrAppendAnnotationTODS__,updateCommentTODS:__updateCommentTODS__,deleteCommentFROMDS:__deleteCommentFROMDS__,openAnnotation:__openAnnotation__,readAnnotationFromDataStore:__readAnnotationFromDataStore__,writeAnnotationToDataStore:__writeAnnotationToDataStore__};