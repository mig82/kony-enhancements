/*! KonyVisualizerV8420 2019-06-14 */

var createComment=function(e,t){var m={};t?(m.createdById=t.user_guid,m.createdBy=t.first_name+" "+t.last_name,m.createdByEmail=t.primary_email):(m.createdById=null,m.createdBy="Anonymous",m.createdByEmail=null);var n=generateCommentId();return m.commentId=n,m.label=e.label||"",m.createdOn=(new Date).getTime(),m.lastModifiedTime=m.createdOn,m.active=1,m.widgetId=e.widgetId,m.formId=e.formId,m.channel=e.channel,m.comment=e.comment,m},createRequirement=function(e,t){var m=createComment(e,t);return m.requirementId=m.commentId,m.body=e.body,delete m.commentId,m},updateComment=function(e,t,m){var n=e.commentId,r=e.widgetId,a=m.comments[r];if(void 0!==a[n]){var d=t?t.user_guid:null;if(!a[n].createdById&&d)e.createdById=d,e.createdBy=t.first_name+" "+t.last_name,e.createdByEmail=t.primary_email,e.createdOn=(new Date).getTime();else if(d&&d!=a[n].createdById)return m;e.active=Number(e.active),e.lastModifiedTime=(new Date).getTime(),a[n]=e,m.comments[r]=a}return m},updateRequirement=function(e,t,m){var n=e.widgetId,r=e.requirementId;return e.active=Number(e.active),e.lastModifiedTime=Number(e.lastModifiedTime),m.requirements[n][r]=e,m},generateCommentId=function(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getCommentParam=function(e){return{guid:e.commentId,created_on:Number(e.createdOn),created_by_guid:e.createdById,created_by:e.createdBy,created_by_email:e.createdByEmail,modified_on:Number(e.lastModifiedTime),comment:e.comment,comment_src:"undefined"!=typeof module&&module.exports?COMMENT_SRC_APP.VIZ:COMMENT_SRC_APP.FP,active:e.active}},getNoteParam=function(e){return{guid:e.noteGuid,widget_id:e.widgetId,form_id:e.formId,form_channel:e.channel,created_on:Number(e.createdOn),modified_on:Number(e.modifiedOn),active:e.active}},formatComment=function(e){return{commentId:e.guid,widgetId:e.widget_id,formId:e.form_id,createdOn:new Date(e.created_on).getTime(),createdById:e.created_by_guid,createdBy:e.created_by,createdByEmail:e.created_by_email,lastModifiedTime:new Date(e.modified_on).getTime(),comment:e.comment,commentSrc:e.comment_src,active:e.active,channel:e.form_channel}},filterRequirements=function(e){return e.filter(function(e){return 2===e.type})},annotationsUtil={createComment:createComment,updateComment:updateComment,generateCommentId:generateCommentId,getCommentParam:getCommentParam,getNoteParam:getNoteParam,formatComment:formatComment,createRequirement:createRequirement,updateRequirement:updateRequirement,filterRequirements:filterRequirements},COMMENT_SRC_APP={FP:"functional preview",VIZ:"visualizer"},COMMENT_TYPE={COMMENT:1,REQUIREMENT:2};"undefined"!=typeof module&&module.exports&&(module.exports=annotationsUtil);